# 协同平台参数修改设计文档

标签（空格分隔）： 设计文档

---
[TOC]

### 一、需求概述
上海参数平台已经实现参数通过模板导入进行修改的功能，随后将在10月底前完成通过界面点选的方式进行参数修改。
在此基础上，实现参数修改功能对接协同平台，实现从协同平台接单、回单的功能。
> 1、由我方设计流程接口，接口主要包括两部分
a) 参数修改任务单派单接口：由我方系统提供，协同平台调用（可用JSON进行工单数据传递），调用接口后工单可在我方平台的“待办”功能菜单里查看；
b)参数修改结果反馈接口：由协同平台提供，由我方进行调用，将参数修改的情况反馈给协同。
注：以上两个接口都由我方研发来设计，具体需要的字段见下方；b接口我方设计，对端研发负责相应开发。
2、待办功能：显示所有待办工单信息，可通过点击“执行”按钮进行相应参数的修改，点击按钮后跳转到参数修改页面，可复用已有的参数修改功能，完成修改后回到待办点击“回单”按钮，弹窗显示需要输入的信息，信息填写完成后点击“确认”提交，提交后的工单可在“已办”功能中进行查看。
3、已办功能：显示所有已经处理过的工单，并可根据工单号、处理人、时间范围的关键字段进行历史记录查询；
4、一张工单里可能有多个需要修改的参数，可通过点击工单号进行钻取（待办、已办功能都可以钻取详情），回单除了界面上带有的工单号、执行结果、反馈意见之外，每个参数执行成功与否也会反馈。

### 二、DB设计
#### 1、参数修改工单表(tap_pigeon_par_order)
| 字段名        | 类型   |  说明  |
| --------   | -----  | ----  |
| ORDER_NUM        |   VARCHAR2(50)   |   工单编号   |
| platform_ORDER_NUM     | VARCHAR2(50) |   平台工单编号     |
| ORDER_PLATFORM_ID        |   INTEGER   |   工单来源平台编号   |
| ORDER_PLATFORM_NAME        |   VARCHAR2(50)   |   工单来源平台名称   |
| BEFORE_OPERATOR        |    VARCHAR2(50)    |  上一流程操作人  |
| BEFORE_OPERATOR_ID        |    VARCHAR2(50)    |  上一流程操作人id  |
| PAR_NUM        |    INTEGER    |  参数个数  |
| STATUS        |    INTEGER    |  工单状态（-1待办、0处理中、1已办(已回单)）  |
| SEND_DATE        |    DATE    |  派单时间  |
| REPLY_DATE        |    DATE    |  回单时间  |
| REPLY_OPERATOR        |    VARCHAR2(20)    |  回单操作人  |
| REPLY_OPERATOR_ID        |    VARCHAR2(50)    |  回单操作人id  |
| HANDLE_RESULT        |    INTEGER    |  执行结果（-1未执行、0失败、1成功）  |
| FEEDBACK_OPINION        |    VARCHAR2(250)    |  反馈意见  |
| VENDER_ID        |    INTEGER   |  厂家id  |

#### 2、参数修改工单关联参数信息表（tap_pigeon_par_order_pi）
| 字段名        | 类型   |  说明  |
| --------   | -----  |----  |
| INT_ID     | INTEGER |   intId     |
| ORDER_NUM     | VARCHAR2(50) |   工单编号     |
| PAR_NUM     | VARCHAR2(50) |   平台参数编号     |
| CITY_ID     | INTEGER |   区县id     |
| CITY_NAME     | VARCHAR2(20) |   区县名称     |
| VENDER_ID     | INTEGER |   厂家id     |
| ENODEB_ID     | INTEGER |   基站id     |
| ENODEB_NAME     | VARCHAR2(50) |   基站名称     |
| EUTRANCE_CELL_ID     | INTEGER |   小区id     |
| EUTRANCE_CELL_NAME     | VARCHAR2(50) |   小区名称         |
| CGI     | VARCHAR2(20) |   小区cgi     |
| PAR_GROUP_NAME     | VARCHAR2(20) |   参数组名称     |
| PAR_NAME     | VARCHAR2(20) |   参数名称     |
| FIRST_VARIABLE     | VARCHAR2(50) |   变量1     |
| SECOND_VARIABLE     | VARCHAR2(50) |   变量2     |
| PAR_ORIGINAL_VALUE     | VARCHAR2(20) |   参数原始值     |
| PAR_ALTER_VALUE     | VARCHAR2(20) |   参数修改值     |
| PAR_ALTER_CMD     | VARCHAR2(50) |   参数修改指令     |
| PAR_ALTER_LOG     | VARCHAR2(250) |   参数修改日志     |
| PAR_ALTER_STATUS     | INTEGER |   参数修改状态（-1未执行、0失败、1成功）     |
#### 3、参数修改工单平台信息表（TAP_PIGEON_PAR_ORDER_PF）
| 字段名        | 类型   |  说明  |
| --------   | -----  |----  |
| PLATFORM_ID     | INTEGER|   平台id编号     |
| PLATFORM_NAME     | VARCHAR2(20) |   平台名称     |
| PLATFORM_REPLY_URL     | VARCHAR2(50) |   平台回单url地址     |




### 三、功能序列图
```sequence
协同平台->>参数平台后端: 调用派单接口
activate 参数平台后端
参数平台后端->>oracle数据库: 存入工单表
oracle数据库-->>参数平台后端: 入库成功
参数平台后端-X参数平台前端: 通知有新待办工单
参数平台后端-->>协同平台:派单成功
deactivate 参数平台后端

activate 参数平台后端
参数平台前端->>参数平台后端: 处理待办工单
参数平台后端->>oracle数据库: 校验修改工单状态（0处理中）
oracle数据库-->>参数平台后端: 工单信息
参数平台后端-->>参数平台前端: 工单信息
deactivate 参数平台后端

activate 参数平台后端
参数平台前端->>参数平台后端: 执行工单参数修改
参数平台后端->>参数平台后端: 执行参数修改
参数平台后端->>oracle数据库: 保存参数修改信息
参数平台后端-->>参数平台前端: 参数修改信息
deactivate 参数平台后端

activate 参数平台后端
参数平台前端->>参数平台后端: 回单
参数平台后端->>协同平台: 调用回单接口
协同平台-->>参数平台后端: 回单成功
参数平台后端-->>参数平台前端: 回单成功
deactivate 参数平台后端

```
### 四、派单接口
#### 1、接口协议类型
> REST服务

#### 2、接口方法
> /Teamwork/sendParOrder

#### 3、接口请求方式
>POST

#### 4、接口方法参数说明

<table>
    <thead>
        <th colspan="2">参数名</th>
        <th>参数类型</th>
        <th>参数含义</th>
        <th>参数说明</th>
        <th>是否必填</th>
    </thead>
    <tr>
        <td  colspan="2">platformOrderNum</td>
        <td>字符串</td>
        <td>平台工单号</td>
        <td></td>
        <td>是</td>
    </tr>
    <tr>
        <td  colspan="2">orderPlatformId</td>
        <td>数值</td>
        <td>工单来源平台编号</td>
        <td>协同平台10001</td>
        <td>是</td>
    </tr>
    <tr>
        <td  colspan="2">orderPlatformName</td>
        <td>字符串</td>
        <td>工单来源平台名称</td>
        <td>协同平台</td>
        <td>是</td>
    </tr>
    <tr>
        <td  colspan="2">venderId</td>
        <td>数值</td>
        <td>厂家编号</td>
        <td>8（华为）、4（诺西）</td>
        <td>是</td>
    </tr>
    <tr>
        <td  colspan="2">beforeOperator</td>
        <td>字符串</td>
        <td>上一流程处理人</td>
        <td></td>
        <td>否</td>
    </tr>
    <tr>
        <td  colspan="2">beforeOperatorId</td>
        <td>字符串</td>
        <td>上一流程处理人id</td>
        <td></td>
        <td>否</td>
    </tr>
    <tr>
        <td  colspan="2">sendOrderParInfos</td>
        <td>对象数组</td>
        <td>派单参数信息</td>
        <td></td>
        <td>是</td>
    </tr>
    <tr>
        <td></td>
        <td>parNum</td>
        <td>字符串</td>
        <td>参数编号</td>
        <td>标识</td>
        <td>否</td>
    </tr>
    <tr>
        <td></td>
        <td>cityId</td>
        <td>数值</td>
        <td>区县id</td>
        <td></td>
        <td>否</td>
    </tr>
    <tr>
        <td></td>
        <td>cityName</td>
        <td>字符串</td>
        <td>区县名称</td>
        <td></td>
        <td>否</td>
    </tr>
    <tr>
        <td></td>
        <td>venderId</td>
        <td>数值</td>
        <td>厂家id</td>
        <td></td>
        <td>是</td>
    </tr>
    <tr>
        <td></td>
        <td>enodebId</td>
        <td>数值</td>
        <td>基站id</td>
        <td></td>
        <td>是</td>
    </tr>
    <tr>
        <td></td>
        <td>enodebName</td>
        <td>字符串</td>
        <td>基站名称</td>
        <td></td>
        <td>是</td>
    </tr>
    <tr>
        <td></td>
        <td>eutranceCellId</td>
        <td>数值</td>
        <td>小区id</td>
        <td></td>
        <td>是</td>
    </tr>
    <tr>
        <td></td>
        <td>eutranceCellName</td>
        <td>字符串</td>
        <td>小区名称</td>
        <td></td>
        <td>是</td>
    </tr>
    <tr>
        <td></td>
        <td>cgi</td>
        <td>字符串</td>
        <td>小区cgi</td>
        <td></td>
        <td>是</td>
    </tr>
    <tr>
        <td></td>
        <td>parGroupName</td>
        <td>字符串</td>
        <td>影响范围（受此参数影响的网元范围）</td>
        <td></td>
        <td>是</td>
    </tr>
    <tr>
        <td></td>
        <td>parName</td>
        <td>字符串</td>
        <td>参数名称</td>
        <td></td>
        <td>是</td>
    </tr>
    <tr>
        <td></td>
        <td>parOriginalValue</td>
        <td>字符串</td>
        <td>参数原始值</td>
        <td></td>
        <td>是</td>
    </tr>
    <tr>
        <td></td>
        <td>parAlterValue</td>
        <td>字符串</td>
        <td>参数修改值</td>
        <td></td>
        <td>是</td>
    </tr>
    <tr>
        <td></td>
        <td>firstVariable</td>
        <td>字符串</td>
        <td>变量1</td>
        <td></td>
        <td>否</td>
    </tr>
    <tr>
        <td></td>
        <td>parAlterValue</td>
        <td>字符串</td>
        <td>变量2</td>
        <td></td>
        <td>否</td>
    </tr>
</table>

#### 5、接口方法返回结果说明

<table>
    <thead>
        <th>参数名</th>
        <th>参数类型</th>
        <th>参数含义</th>
        <th>参数说明</th>
    </thead>
    <tr>
        <th>status</th>
        <th>数值</th>
        <th>执行状态</th>
        <th>0为成功、其他值为失败</th>
    </tr>
    <tr>
        <th>message </th>
        <th>字符串</th>
        <th>提示信息 </th>
        <th>成功/失败</th>
    </tr>
    <tr>
        <th>data  </th>
        <th>对象</th>
        <th>业务数据 </th>
        <th>空</th>
    </tr>
</table>
#### 6、接口提供方
> 参数平台

#### 7、接口调用方
> 协同平台

### 五、回单接口
#### 1、接口协议类型
> REST服务

#### 2、接口方法
> /Teamwork/replyParOrder

#### 3、接口请求方式
>POST

#### 4、接口方法参数说明

<table>
    <thead>
        <th colspan="2">参数名</th>
        <th>参数类型</th>
        <th>参数含义</th>
        <th>参数说明</th>
        <th>是否必填</th>
    </thead>
    <tr>
        <td  colspan="2">platformOrderNum</td>
        <td>字符串</td>
        <td>平台工单号</td>
        <td></td>
        <td>是</td>
    </tr>
    <tr>
        <td  colspan="2">orderPlatformId</td>
        <td>数值</td>
        <td>工单来源平台编号</td>
        <td>协同平台10001</td>
        <td>是</td>
    </tr>
    <tr>
        <td  colspan="2">orderPlatformName</td>
        <td>字符串</td>
        <td>工单来源平台名称</td>
        <td>协同平台</td>
        <td>是</td>
    </tr>
    <tr>
        <td  colspan="2">handleResult</td>
        <td>数值</td>
        <td>处理结果</td>
        <td>0（失败）、1（成功）</td>
        <td>是</td>
    </tr>
    <tr>
        <td  colspan="2">feedbackOpinion</td>
        <td>字符串</td>
        <td>反馈意见</td>
        <td> </td>
        <td>是</td>
    </tr>
    <tr>
        <td  colspan="2">orderParInfos</td>
        <td>对象数组</td>
        <td>回单参数信息</td>
        <td></td>
        <td>是</td>
    </tr>
    <tr>
        <td></td>
        <td>parNum</td>
        <td>字符串</td>
        <td>参数编号</td>
        <td>标识</td>
        <td>否</td>
    </tr>
    <tr>
        <td></td>
        <td>cityId</td>
        <td>数值</td>
        <td>区县id</td>
        <td></td>
        <td>否</td>
    </tr>
    <tr>
        <td></td>
        <td>cityName</td>
        <td>字符串</td>
        <td>区县名称</td>
        <td></td>
        <td>否</td>
    </tr>
    <tr>
        <td></td>
        <td>venderId</td>
        <td>数值</td>
        <td>厂家id</td>
        <td></td>
        <td>是</td>
    </tr>
    <tr>
        <td></td>
        <td>enodebId</td>
        <td>数值</td>
        <td>基站id</td>
        <td></td>
        <td>是</td>
    </tr>
    <tr>
        <td></td>
        <td>enodebName</td>
        <td>字符串</td>
        <td>基站名称</td>
        <td></td>
        <td>是</td>
    </tr>
    <tr>
        <td></td>
        <td>eutranceCellId</td>
        <td>数值</td>
        <td>小区id</td>
        <td></td>
        <td>是</td>
    </tr>
    <tr>
        <td></td>
        <td>eutranceCellName</td>
        <td>字符串</td>
        <td>小区名称</td>
        <td></td>
        <td>是</td>
    </tr>
    <tr>
        <td></td>
        <td>cgi</td>
        <td>字符串</td>
        <td>小区cgi</td>
        <td></td>
        <td>是</td>
    </tr>
    <tr>
        <td></td>
        <td>parGroupName</td>
        <td>字符串</td>
        <td>影响范围（受此参数影响的网元范围）</td>
        <td></td>
        <td>是</td>
    </tr>
    <tr>
        <td></td>
        <td>parName</td>
        <td>字符串</td>
        <td>参数名称</td>
        <td></td>
        <td>是</td>
    </tr>
    <tr>
        <td></td>
        <td>parOriginalValue</td>
        <td>字符串</td>
        <td>参数原始值</td>
        <td></td>
        <td>是</td>
    </tr>
    <tr>
        <td></td>
        <td>parAlterValue</td>
        <td>字符串</td>
        <td>参数修改值</td>
        <td></td>
        <td>是</td>
    </tr>
    <tr>
        <td></td>
        <td>firstVariable</td>
        <td>字符串</td>
        <td>变量1</td>
        <td></td>
        <td>否</td>
    </tr>
    <tr>
        <td></td>
        <td>parAlterValue</td>
        <td>字符串</td>
        <td>变量2</td>
        <td></td>
        <td>否</td>
    </tr>
    <tr>
        <td></td>
        <td>parAlterStatus</td>
        <td>数值</td>
        <td>参数修改状态</td>
        <td>参数修改状态（-1未执行、0失败、1成功）</td>
        <td>是</td>
    </tr>
</table>

#### 5、接口方法返回结果说明

<table>
    <thead>
        <th>参数名</th>
        <th>参数类型</th>
        <th>参数含义</th>
        <th>参数说明</th>
    </thead>
    <tr>
        <th>status</th>
        <th>数值</th>
        <th>执行状态</th>
        <th>0为成功、其他值为失败</th>
    </tr>
    <tr>
        <th>message </th>
        <th>字符串</th>
        <th>提示信息 </th>
        <th>成功/失败</th>
    </tr>
    <tr>
        <th>data  </th>
        <th>对象</th>
        <th>业务数据 </th>
        <th>空</th>
    </tr>
</table>
#### 6、接口提供方
> 协同平台

#### 7、接口调用方
> 参数平台













